//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------- Function Prototypes --------------------

int64_t __acrt_iob_func(int64_t a1);
int64_t __do_global_ctors(void);
int64_t __main(void);

// --------------------- Global Variables ---------------------

int32_t g1 = -1; // 0x402f50
int32_t g2 = 0; // 0x407030
int32_t g3;

// ------- Dynamically Linked Functions Without Header --------

int64_t __iob_func(void);

// ------------------------ Functions -------------------------

// Address range: 0x401550 - 0x401816
int main(int argc, char ** argv) {
    // 0x401550
    __main();
    int64_t * mem = malloc(256); // 0x401562
    if (mem == NULL) {
        // 0x401810
        return puts("No memory");
    }
    // 0x401583
    Sleep(1000);
    puts("You woke up.");
    Sleep(2000);
    puts("You look at your left,");
    Sleep(2200);
    puts("Through the window,");
    Sleep(1900);
    puts("Where the birds are chirping,");
    Sleep(1880);
    puts("And the Sun is giving its brightest kiss on your face.");
    Sleep(1950);
    puts("\"Ah, a beautiful day for a walk!\"you thought to yourself.");
    Sleep(1800);
    puts("You brushed your teeth,");
    Sleep(1000);
    puts("Rinsed your face,");
    Sleep(1200);
    puts("What would you like to drink?");
    fgets((char *)mem, 256, (struct _IO_FILE *)__acrt_iob_func(0));
    if (*(char *)mem != 0) {
        int32_t len = strlen((char *)mem); // 0x401680
        int64_t v1 = (int64_t)mem - 1;
        if (*(char *)(v1 + (int64_t)len) == 10) {
            // 0x401697
            *(char *)(v1 + (int64_t)strlen((char *)mem)) = 0;
        }
    }
    // 0x4016b1
    printf("An excellent choice! You took a refreshing sip of %s ,\n", mem);
    Sleep(1880);
    puts("And the main course?");
    fgets((char *)mem, 256, (struct _IO_FILE *)__acrt_iob_func(0));
    if (*(char *)mem != 0) {
        int32_t len2 = strlen((char *)mem); // 0x401711
        int64_t v2 = (int64_t)mem - 1;
        if (*(char *)(v2 + (int64_t)len2) == 10) {
            // 0x401728
            *(char *)(v2 + (int64_t)strlen((char *)mem)) = 0;
        }
    }
    // 0x401742
    printf("As always you eat %s for breakfast.Your favourite!\n", mem);
    Sleep(2000);
    puts("Then, you settled off on a walk...");
    Sleep(2500);
    puts("Look, a fox!");
    Sleep(1000);
    puts("You followed the fox running around,");
    Sleep(2000);
    puts("You stumbled on an abandoned mini library.");
    Sleep(1400);
    puts("Feeling adventurous, you took a book and read...");
    Sleep(1800);
    puts("How interesting! It tells a tale of a--");
    Sleep(500);
    puts("\"Found you.\"");
    Sleep(1000);
    puts("A huge man with a machete in his hand is standing behind you...");
    Sleep(3000);
    // 0x401810
    return &g3;
}

// Address range: 0x401860 - 0x4018c6
int64_t __do_global_ctors(void) {
    int64_t v1 = 0;
    int64_t v2 = v1 + 1 & 0xffffffff; // 0x4018b6
    while (*(int64_t *)(8 * v2 + (int64_t)&g1) != 0) {
        // 0x4018b6
        v1 = v2;
        v2 = v1 + 1 & 0xffffffff;
    }
    if (v1 == 0) {
        // 0x40189b
        return atexit(0x401820);
    }
    int64_t v3 = 8 * (v1 - (v1 + 0xffffffff & 0xffffffff)) + (int64_t)&g1 - 8; // 0x401887
    int64_t v4 = 8 * v1 + (int64_t)&g1; // 0x40188c
    while (v4 - 8 != v3) {
        // 0x401890
        v4 -= 8;
    }
    // 0x40189b
    return atexit(0x401820);
}

// Address range: 0x4018d0 - 0x4018ef
int64_t __main(void) {
    uint32_t result = g2; // 0x4018d0
    if (result != 0) {
        // 0x4018da
        return result;
    }
    // 0x4018e0
    g2 = 1;
    return __do_global_ctors();
}

// Address range: 0x402da0 - 0x402dbf
int64_t __acrt_iob_func(int64_t a1) {
    // 0x402da0
    return __iob_func() + 48 * (a1 & 0xffffffff);
}

// --------------- Statically Linked Functions ----------------

// int64_t atexit(int64_t a1);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (8.1.0)
// Detected functions: 4
